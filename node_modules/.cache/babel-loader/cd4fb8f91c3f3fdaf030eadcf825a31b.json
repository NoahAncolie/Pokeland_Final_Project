{"ast":null,"code":"import _defineProperty from '@babel/runtime/helpers/esm/defineProperty';\nimport { Pass, FullScreenQuad } from './Pass.js';\nimport { WebGLRenderTarget, NearestFilter, MeshDepthMaterial, RGBADepthPacking, NoBlending, UniformsUtils, ShaderMaterial, Color } from 'three';\nimport { BokehShader } from '../shaders/BokehShader.js';\n\nclass BokehPass extends Pass {\n  constructor(scene, camera, params) {\n    super();\n\n    _defineProperty(this, \"scene\", void 0);\n\n    _defineProperty(this, \"camera\", void 0);\n\n    _defineProperty(this, \"renderTargetDepth\", void 0);\n\n    _defineProperty(this, \"materialDepth\", void 0);\n\n    _defineProperty(this, \"materialBokeh\", void 0);\n\n    _defineProperty(this, \"fsQuad\", void 0);\n\n    _defineProperty(this, \"_oldClearColor\", void 0);\n\n    _defineProperty(this, \"uniforms\", void 0);\n\n    this.scene = scene;\n    this.camera = camera;\n    const focus = params.focus !== undefined ? params.focus : 1.0;\n    const aspect = params.aspect !== undefined ? params.aspect : camera.aspect;\n    const aperture = params.aperture !== undefined ? params.aperture : 0.025;\n    const maxblur = params.maxblur !== undefined ? params.maxblur : 1.0; // render targets\n\n    const width = params.width || window.innerWidth || 1;\n    const height = params.height || window.innerHeight || 1;\n    this.renderTargetDepth = new WebGLRenderTarget(width, height, {\n      minFilter: NearestFilter,\n      magFilter: NearestFilter\n    });\n    this.renderTargetDepth.texture.name = 'BokehPass.depth'; // depth material\n\n    this.materialDepth = new MeshDepthMaterial();\n    this.materialDepth.depthPacking = RGBADepthPacking;\n    this.materialDepth.blending = NoBlending; // bokeh material\n\n    if (BokehShader === undefined) {\n      console.error('BokehPass relies on BokehShader');\n    }\n\n    const bokehShader = BokehShader;\n    const bokehUniforms = UniformsUtils.clone(bokehShader.uniforms);\n    bokehUniforms['tDepth'].value = this.renderTargetDepth.texture;\n    bokehUniforms['focus'].value = focus;\n    bokehUniforms['aspect'].value = aspect;\n    bokehUniforms['aperture'].value = aperture;\n    bokehUniforms['maxblur'].value = maxblur;\n    bokehUniforms['nearClip'].value = camera.near;\n    bokehUniforms['farClip'].value = camera.far;\n    this.materialBokeh = new ShaderMaterial({\n      defines: Object.assign({}, bokehShader.defines),\n      uniforms: bokehUniforms,\n      vertexShader: bokehShader.vertexShader,\n      fragmentShader: bokehShader.fragmentShader\n    });\n    this.uniforms = bokehUniforms;\n    this.needsSwap = false;\n    this.fsQuad = new FullScreenQuad(this.materialBokeh);\n    this._oldClearColor = new Color();\n  }\n\n  render(renderer, writeBuffer, readBuffer\n  /*, deltaTime, maskActive */\n  ) {\n    // Render depth into texture\n    this.scene.overrideMaterial = this.materialDepth;\n    renderer.getClearColor(this._oldClearColor);\n    const oldClearAlpha = renderer.getClearAlpha();\n    const oldAutoClear = renderer.autoClear;\n    renderer.autoClear = false;\n    renderer.setClearColor(0xffffff);\n    renderer.setClearAlpha(1.0);\n    renderer.setRenderTarget(this.renderTargetDepth);\n    renderer.clear();\n    renderer.render(this.scene, this.camera); // Render bokeh composite\n\n    this.uniforms['tColor'].value = readBuffer.texture;\n    this.uniforms['nearClip'].value = this.camera.near;\n    this.uniforms['farClip'].value = this.camera.far;\n\n    if (this.renderToScreen) {\n      renderer.setRenderTarget(null);\n      this.fsQuad.render(renderer);\n    } else {\n      renderer.setRenderTarget(writeBuffer);\n      renderer.clear();\n      this.fsQuad.render(renderer);\n    }\n\n    this.scene.overrideMaterial = null;\n    renderer.setClearColor(this._oldClearColor);\n    renderer.setClearAlpha(oldClearAlpha);\n    renderer.autoClear = oldAutoClear;\n  }\n\n}\n\nexport { BokehPass };","map":{"version":3,"names":["_defineProperty","Pass","FullScreenQuad","WebGLRenderTarget","NearestFilter","MeshDepthMaterial","RGBADepthPacking","NoBlending","UniformsUtils","ShaderMaterial","Color","BokehShader","BokehPass","constructor","scene","camera","params","focus","undefined","aspect","aperture","maxblur","width","window","innerWidth","height","innerHeight","renderTargetDepth","minFilter","magFilter","texture","name","materialDepth","depthPacking","blending","console","error","bokehShader","bokehUniforms","clone","uniforms","value","near","far","materialBokeh","defines","Object","assign","vertexShader","fragmentShader","needsSwap","fsQuad","_oldClearColor","render","renderer","writeBuffer","readBuffer","overrideMaterial","getClearColor","oldClearAlpha","getClearAlpha","oldAutoClear","autoClear","setClearColor","setClearAlpha","setRenderTarget","clear","renderToScreen"],"sources":["/home/odin/Desktop/THPâ˜ /Developpeur/Final_Project/pokeland/node_modules/three-stdlib/postprocessing/BokehPass.js"],"sourcesContent":["import _defineProperty from '@babel/runtime/helpers/esm/defineProperty';\nimport { Pass, FullScreenQuad } from './Pass.js';\nimport { WebGLRenderTarget, NearestFilter, MeshDepthMaterial, RGBADepthPacking, NoBlending, UniformsUtils, ShaderMaterial, Color } from 'three';\nimport { BokehShader } from '../shaders/BokehShader.js';\n\nclass BokehPass extends Pass {\n  constructor(scene, camera, params) {\n    super();\n\n    _defineProperty(this, \"scene\", void 0);\n\n    _defineProperty(this, \"camera\", void 0);\n\n    _defineProperty(this, \"renderTargetDepth\", void 0);\n\n    _defineProperty(this, \"materialDepth\", void 0);\n\n    _defineProperty(this, \"materialBokeh\", void 0);\n\n    _defineProperty(this, \"fsQuad\", void 0);\n\n    _defineProperty(this, \"_oldClearColor\", void 0);\n\n    _defineProperty(this, \"uniforms\", void 0);\n\n    this.scene = scene;\n    this.camera = camera;\n    const focus = params.focus !== undefined ? params.focus : 1.0;\n    const aspect = params.aspect !== undefined ? params.aspect : camera.aspect;\n    const aperture = params.aperture !== undefined ? params.aperture : 0.025;\n    const maxblur = params.maxblur !== undefined ? params.maxblur : 1.0; // render targets\n\n    const width = params.width || window.innerWidth || 1;\n    const height = params.height || window.innerHeight || 1;\n    this.renderTargetDepth = new WebGLRenderTarget(width, height, {\n      minFilter: NearestFilter,\n      magFilter: NearestFilter\n    });\n    this.renderTargetDepth.texture.name = 'BokehPass.depth'; // depth material\n\n    this.materialDepth = new MeshDepthMaterial();\n    this.materialDepth.depthPacking = RGBADepthPacking;\n    this.materialDepth.blending = NoBlending; // bokeh material\n\n    if (BokehShader === undefined) {\n      console.error('BokehPass relies on BokehShader');\n    }\n\n    const bokehShader = BokehShader;\n    const bokehUniforms = UniformsUtils.clone(bokehShader.uniforms);\n    bokehUniforms['tDepth'].value = this.renderTargetDepth.texture;\n    bokehUniforms['focus'].value = focus;\n    bokehUniforms['aspect'].value = aspect;\n    bokehUniforms['aperture'].value = aperture;\n    bokehUniforms['maxblur'].value = maxblur;\n    bokehUniforms['nearClip'].value = camera.near;\n    bokehUniforms['farClip'].value = camera.far;\n    this.materialBokeh = new ShaderMaterial({\n      defines: Object.assign({}, bokehShader.defines),\n      uniforms: bokehUniforms,\n      vertexShader: bokehShader.vertexShader,\n      fragmentShader: bokehShader.fragmentShader\n    });\n    this.uniforms = bokehUniforms;\n    this.needsSwap = false;\n    this.fsQuad = new FullScreenQuad(this.materialBokeh);\n    this._oldClearColor = new Color();\n  }\n\n  render(renderer, writeBuffer, readBuffer\n  /*, deltaTime, maskActive */\n  ) {\n    // Render depth into texture\n    this.scene.overrideMaterial = this.materialDepth;\n    renderer.getClearColor(this._oldClearColor);\n    const oldClearAlpha = renderer.getClearAlpha();\n    const oldAutoClear = renderer.autoClear;\n    renderer.autoClear = false;\n    renderer.setClearColor(0xffffff);\n    renderer.setClearAlpha(1.0);\n    renderer.setRenderTarget(this.renderTargetDepth);\n    renderer.clear();\n    renderer.render(this.scene, this.camera); // Render bokeh composite\n\n    this.uniforms['tColor'].value = readBuffer.texture;\n    this.uniforms['nearClip'].value = this.camera.near;\n    this.uniforms['farClip'].value = this.camera.far;\n\n    if (this.renderToScreen) {\n      renderer.setRenderTarget(null);\n      this.fsQuad.render(renderer);\n    } else {\n      renderer.setRenderTarget(writeBuffer);\n      renderer.clear();\n      this.fsQuad.render(renderer);\n    }\n\n    this.scene.overrideMaterial = null;\n    renderer.setClearColor(this._oldClearColor);\n    renderer.setClearAlpha(oldClearAlpha);\n    renderer.autoClear = oldAutoClear;\n  }\n\n}\n\nexport { BokehPass };\n"],"mappings":"AAAA,OAAOA,eAAP,MAA4B,2CAA5B;AACA,SAASC,IAAT,EAAeC,cAAf,QAAqC,WAArC;AACA,SAASC,iBAAT,EAA4BC,aAA5B,EAA2CC,iBAA3C,EAA8DC,gBAA9D,EAAgFC,UAAhF,EAA4FC,aAA5F,EAA2GC,cAA3G,EAA2HC,KAA3H,QAAwI,OAAxI;AACA,SAASC,WAAT,QAA4B,2BAA5B;;AAEA,MAAMC,SAAN,SAAwBX,IAAxB,CAA6B;EAC3BY,WAAW,CAACC,KAAD,EAAQC,MAAR,EAAgBC,MAAhB,EAAwB;IACjC;;IAEAhB,eAAe,CAAC,IAAD,EAAO,OAAP,EAAgB,KAAK,CAArB,CAAf;;IAEAA,eAAe,CAAC,IAAD,EAAO,QAAP,EAAiB,KAAK,CAAtB,CAAf;;IAEAA,eAAe,CAAC,IAAD,EAAO,mBAAP,EAA4B,KAAK,CAAjC,CAAf;;IAEAA,eAAe,CAAC,IAAD,EAAO,eAAP,EAAwB,KAAK,CAA7B,CAAf;;IAEAA,eAAe,CAAC,IAAD,EAAO,eAAP,EAAwB,KAAK,CAA7B,CAAf;;IAEAA,eAAe,CAAC,IAAD,EAAO,QAAP,EAAiB,KAAK,CAAtB,CAAf;;IAEAA,eAAe,CAAC,IAAD,EAAO,gBAAP,EAAyB,KAAK,CAA9B,CAAf;;IAEAA,eAAe,CAAC,IAAD,EAAO,UAAP,EAAmB,KAAK,CAAxB,CAAf;;IAEA,KAAKc,KAAL,GAAaA,KAAb;IACA,KAAKC,MAAL,GAAcA,MAAd;IACA,MAAME,KAAK,GAAGD,MAAM,CAACC,KAAP,KAAiBC,SAAjB,GAA6BF,MAAM,CAACC,KAApC,GAA4C,GAA1D;IACA,MAAME,MAAM,GAAGH,MAAM,CAACG,MAAP,KAAkBD,SAAlB,GAA8BF,MAAM,CAACG,MAArC,GAA8CJ,MAAM,CAACI,MAApE;IACA,MAAMC,QAAQ,GAAGJ,MAAM,CAACI,QAAP,KAAoBF,SAApB,GAAgCF,MAAM,CAACI,QAAvC,GAAkD,KAAnE;IACA,MAAMC,OAAO,GAAGL,MAAM,CAACK,OAAP,KAAmBH,SAAnB,GAA+BF,MAAM,CAACK,OAAtC,GAAgD,GAAhE,CAxBiC,CAwBoC;;IAErE,MAAMC,KAAK,GAAGN,MAAM,CAACM,KAAP,IAAgBC,MAAM,CAACC,UAAvB,IAAqC,CAAnD;IACA,MAAMC,MAAM,GAAGT,MAAM,CAACS,MAAP,IAAiBF,MAAM,CAACG,WAAxB,IAAuC,CAAtD;IACA,KAAKC,iBAAL,GAAyB,IAAIxB,iBAAJ,CAAsBmB,KAAtB,EAA6BG,MAA7B,EAAqC;MAC5DG,SAAS,EAAExB,aADiD;MAE5DyB,SAAS,EAAEzB;IAFiD,CAArC,CAAzB;IAIA,KAAKuB,iBAAL,CAAuBG,OAAvB,CAA+BC,IAA/B,GAAsC,iBAAtC,CAhCiC,CAgCwB;;IAEzD,KAAKC,aAAL,GAAqB,IAAI3B,iBAAJ,EAArB;IACA,KAAK2B,aAAL,CAAmBC,YAAnB,GAAkC3B,gBAAlC;IACA,KAAK0B,aAAL,CAAmBE,QAAnB,GAA8B3B,UAA9B,CApCiC,CAoCS;;IAE1C,IAAII,WAAW,KAAKO,SAApB,EAA+B;MAC7BiB,OAAO,CAACC,KAAR,CAAc,iCAAd;IACD;;IAED,MAAMC,WAAW,GAAG1B,WAApB;IACA,MAAM2B,aAAa,GAAG9B,aAAa,CAAC+B,KAAd,CAAoBF,WAAW,CAACG,QAAhC,CAAtB;IACAF,aAAa,CAAC,QAAD,CAAb,CAAwBG,KAAxB,GAAgC,KAAKd,iBAAL,CAAuBG,OAAvD;IACAQ,aAAa,CAAC,OAAD,CAAb,CAAuBG,KAAvB,GAA+BxB,KAA/B;IACAqB,aAAa,CAAC,QAAD,CAAb,CAAwBG,KAAxB,GAAgCtB,MAAhC;IACAmB,aAAa,CAAC,UAAD,CAAb,CAA0BG,KAA1B,GAAkCrB,QAAlC;IACAkB,aAAa,CAAC,SAAD,CAAb,CAAyBG,KAAzB,GAAiCpB,OAAjC;IACAiB,aAAa,CAAC,UAAD,CAAb,CAA0BG,KAA1B,GAAkC1B,MAAM,CAAC2B,IAAzC;IACAJ,aAAa,CAAC,SAAD,CAAb,CAAyBG,KAAzB,GAAiC1B,MAAM,CAAC4B,GAAxC;IACA,KAAKC,aAAL,GAAqB,IAAInC,cAAJ,CAAmB;MACtCoC,OAAO,EAAEC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBV,WAAW,CAACQ,OAA9B,CAD6B;MAEtCL,QAAQ,EAAEF,aAF4B;MAGtCU,YAAY,EAAEX,WAAW,CAACW,YAHY;MAItCC,cAAc,EAAEZ,WAAW,CAACY;IAJU,CAAnB,CAArB;IAMA,KAAKT,QAAL,GAAgBF,aAAhB;IACA,KAAKY,SAAL,GAAiB,KAAjB;IACA,KAAKC,MAAL,GAAc,IAAIjD,cAAJ,CAAmB,KAAK0C,aAAxB,CAAd;IACA,KAAKQ,cAAL,GAAsB,IAAI1C,KAAJ,EAAtB;EACD;;EAED2C,MAAM,CAACC,QAAD,EAAWC,WAAX,EAAwBC;EAC9B;EADM,EAEJ;IACA;IACA,KAAK1C,KAAL,CAAW2C,gBAAX,GAA8B,KAAKzB,aAAnC;IACAsB,QAAQ,CAACI,aAAT,CAAuB,KAAKN,cAA5B;IACA,MAAMO,aAAa,GAAGL,QAAQ,CAACM,aAAT,EAAtB;IACA,MAAMC,YAAY,GAAGP,QAAQ,CAACQ,SAA9B;IACAR,QAAQ,CAACQ,SAAT,GAAqB,KAArB;IACAR,QAAQ,CAACS,aAAT,CAAuB,QAAvB;IACAT,QAAQ,CAACU,aAAT,CAAuB,GAAvB;IACAV,QAAQ,CAACW,eAAT,CAAyB,KAAKtC,iBAA9B;IACA2B,QAAQ,CAACY,KAAT;IACAZ,QAAQ,CAACD,MAAT,CAAgB,KAAKvC,KAArB,EAA4B,KAAKC,MAAjC,EAXA,CAW0C;;IAE1C,KAAKyB,QAAL,CAAc,QAAd,EAAwBC,KAAxB,GAAgCe,UAAU,CAAC1B,OAA3C;IACA,KAAKU,QAAL,CAAc,UAAd,EAA0BC,KAA1B,GAAkC,KAAK1B,MAAL,CAAY2B,IAA9C;IACA,KAAKF,QAAL,CAAc,SAAd,EAAyBC,KAAzB,GAAiC,KAAK1B,MAAL,CAAY4B,GAA7C;;IAEA,IAAI,KAAKwB,cAAT,EAAyB;MACvBb,QAAQ,CAACW,eAAT,CAAyB,IAAzB;MACA,KAAKd,MAAL,CAAYE,MAAZ,CAAmBC,QAAnB;IACD,CAHD,MAGO;MACLA,QAAQ,CAACW,eAAT,CAAyBV,WAAzB;MACAD,QAAQ,CAACY,KAAT;MACA,KAAKf,MAAL,CAAYE,MAAZ,CAAmBC,QAAnB;IACD;;IAED,KAAKxC,KAAL,CAAW2C,gBAAX,GAA8B,IAA9B;IACAH,QAAQ,CAACS,aAAT,CAAuB,KAAKX,cAA5B;IACAE,QAAQ,CAACU,aAAT,CAAuBL,aAAvB;IACAL,QAAQ,CAACQ,SAAT,GAAqBD,YAArB;EACD;;AAhG0B;;AAoG7B,SAASjD,SAAT"},"metadata":{},"sourceType":"module"}